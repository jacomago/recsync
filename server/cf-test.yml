include:
  - docker/cf-compose.yml
services:
  recc:
    build: .
    depends_on:
      cf:
        condition: service_healthy
        restart: true
    healthcheck:
      test: netstat | grep cf
      interval: 10s
      timeout: 30s
      retries: 3
    volumes:
      - type: bind
        source: docker/config/cf1.conf
        target: /home/recceiver/cf.conf
        read_only: true
      - type: bind
        source: docker/config/cf.conf
        target: /home/recceiver/channelfinderapi.conf
        read_only: true
    networks:
      - net-1-recc-1
      - net-2-cf

  ioc1-1:
    extends:
      file: ../client/ioc-compose.yml
      service: ioc1
    depends_on:
      recc1:
        condition: service_healthy
        restart: true
    environment:
      - IOCSH_NAME=IOC1-1
    hostname: ioc1-1
    networks:
      - net-1-recc-1
  ioc1-2:
    extends:
      ioc1-1
    depends_on:
      recc1:
        condition: service_healthy
        restart: true
    environment:
      - IOCSH_NAME=IOC1-2
    hostname: ioc1-1
  ioc2-1:
    extends:
      ioc1-1
    depends_on:
      recc1:
        condition: service_healthy
        restart: true
    environment:
      - IOCSH_NAME=IOC2-1
    hostname: ioc2-1
    networks:
      - net-1-recc-1
  ioc2-2:
    extends:
      ioc2-1
    depends_on:
      recc1:
        condition: service_healthy
        restart: true
    environment:
      - IOCSH_NAME=IOC2-2
    hostname: ioc2-2
networks:
  net-1-recc-1:
    driver: bridge
